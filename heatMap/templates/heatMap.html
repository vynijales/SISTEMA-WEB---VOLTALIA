<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Mapa de calor com Mapbox GL JS</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css' rel='stylesheet' />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .fixed-top {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      z-index: 1030;
      background-color: #fff;
      border-bottom: solid 1px #eee;
    }

    #map {
      height: 700px;
      border: solid 20px #000;
      margin-top: 58px;
    }

    .teste {
      background-color: aqua;
    }
  </style>
</head>

<body>
  <header class="fixed-top">
    <div class="container text-left">
      <div class="row align-items-center logo ">
        <div class="col d-flex align-items-center col-sm-6 col-md-8">
          <a href="#">
            <img id="logo"
              src="https://www.voltalia.com/sites/g/files/knoqqb77836/themes/site/nir_pid3850/dist/images/logo.png"
              alt="Voltalia">
          </a>
        </div>
        <div class="col col-6 col-md-4">
          <form id="myForm" action="{% url 'salvar' %}" method="post">
            <div class="form-floating">
              <!-- <select name="myselect" id="myselect" onchange="this.form.submit()"></select> -->
              <select class="form-select" id="floatingSelect" aria-label="Floating label select example" name="selected"
                onchange="alterandoMes(mes)">
                <option value="janeiro21">Janeiro 2021</option>
                <option value="fevereiro21">Fevereiro 2021</option>
                <option value="marco21">Março 2021</option>
                <option value="abril21">Abril 2021</option>
                <option value="maio21">Maio 2021</option>
                <option value="junho21">Junho 2021</option>
                <option value="julho21">Julho 2021</option>
                <option value="agosto21">Agosto 2021</option>
                <option value="setembro21">Setembro 2021</option>
                <option value="outubro21">Outubro 2021</option>
                <option value="novembro21">Novembro 2021</option>
                <option value="dezembro21">Dezembro 2021</option>
                <option value="Janeiro22">Janeiro 2021</option>
              </select>
              <label for="floatingSelect">Amostras</label>
            </div>
            {% csrf_token %}
          </form>
        </div>
      </div>
    </div>

  </header>

  <div class="border" id='map'></div>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js'></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoidnluaWphbGVzIiwiYSI6ImNsZjh4YWo5bDBpaHMzcmtlZzM3MGJoZ2gifQ._Wm3t6w7QFppRKUvL6CXYA';

    /*
    {{teste}} 
    */

    // var mes = document.getElementsByName("selected")[0].value || "janeiro21"

    // function alterandoMes(){
    //   console.log(mes)
    //   teste = document.getElementsByName("selected")[0].value
    //   console.log(teste)
    // }

    let coordinates = {{ coordenadas_list }};

let weights = [];

for (let i = 0; i < 29 ;i++) {
  weights.push(Math.random())
}

let data = {
  type: 'FeatureCollection',
  features: coordinates.map((coordinate, index) => {
    return {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: coordinate,
      },
      properties: {
        weight: weights[index],
      },
    };
  }),
};

let map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v11',
  center: [16.90874, 45.34907],
  zoom: 2,
});

map.on('load', function () {
  // Adiciona o mapa de calor
  map.addLayer({
    id: 'heatmap',
    type: 'circle',
    source: {
      type: 'geojson',
      data: data,
    },
    'paint': {
      'circle-color': [
        'interpolate',
        ['linear'],
        ['get', 'weight'],
        0, 'hsl(0, 100%, 50%)',
        0.2, 'hsl(50, 100%, 50%)',
        0.6, 'hsl(90, 100%, 50%)',
        1, 'hsl(120, 100%, 50%)'
      ],
      'circle-radius': {
        'stops': [
          [0, 5],
          [2, 10],
          [4, 15],
          [6, 20],
          [8, 25]
        ]
      },
      'circle-opacity': 0.5,
      'circle-radius': 30
    }

  });


  // Adiciona o marcador
  coordinates.forEach(element => {
    new mapboxgl.Marker()
      .setLngLat(element)
      .addTo(map);
  });
});




    // Formulário
    // const form = document.getElementById('myForm');
    // const select = document.getElementById('meses');
    // select.addEventListener('change', function () {
    //   form.submit();
    //   console.log("Bom dia!")
    // });




  </script>


  <footer class="bd-footer ">
    <div class="container py-4 py-md-5 px-4 px-md-3 text-body-secondary">
      <div class="row align-items-center">
        <div class="row mb-3">
          <a class="d-inline-flex align-items-center mb-2 text-body-secondary text-decoration-none" href="/"
            aria-label="Bootstrap">
            <h4 class="fs-5">Projeto: Voltalia</h4>
          </a>
          <ul class="list-unstyled small">
            <li class="mb-2">Este site foi projetado com base no modelo fornecido pela empresa Voltalia
              (www.voltalia.com) e inclui o uso do logotipo da empresa. Agradecemos à Voltalia pela disponibilização do
              modelo e pela inspiração para o design deste site.</li>
          </ul>
        </div>
        <div class="row d-flex align-items-center row-sm-6 row-md-8">

          <div class="row align-items-center">
            <h5>Tecnologias utilizadas</h5>
            <ul class="list-unstyled row align-items-center">
              <li class="col col-6 col-md-1 m-3"><img
                  src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/django/django-plain-wordmark.svg" width="40"
                  height="40" /></li>
              <li class="col col-6 col-md-1 m-3"><img
                  src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/postgresql/postgresql-original.svg" width="40"
                  height="40" /></li>
              <li class="col col-6 col-md-1 m-3"><img
                  src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/bootstrap/bootstrap-original.svg" width="40"
                  height="40" /></li>
              <li class="col col-6 col-md-1 m-3"><img
                  src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original-wordmark.svg"
                  width="40" height="40" /></li>
              <li class="col col-6 col-md-1 m-3"><img src="https://day-journal.com/memo/images/logo/mapboxgljs.png"
                  width="100" height="50" /></li>
              {% for coordenada in coordenadas %}
              <li>ID: {{ coordenada.id }}, Latitude {{ coordenada.latitude }}, Longitude {{ coordenada.longitude }}.
              </li>
              {% endfor%}
              {% csrf_token %}

            </ul>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script>
    let mes = document.getElementsByName("selected")[0].value || "janeiro21"

    function alterandoMes(m) {
      return selectedOption = document.getElementsByName("selected")[0].value;
    }

    document.getElementsByName("selected")[0].addEventListener('change', function () {
      mes = alterandoMes();
    });

  </script>
</body>

</html>